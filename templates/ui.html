<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vietnam Travel AI</title>

<style>
:root{
    --bg:#f7f7f8;
    --user:#d2f4ea;
    --bot:#ffffff;
    --primary:#0a7cff;
}

*{box-sizing:border-box}
body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background:var(--bg);
    display:flex;
    flex-direction:column;
    height:100vh;
}

header{
    background:#fff;
    border-bottom:1px solid #ddd;
    padding:10px 16px;
    display:flex;
    align-items:center;
    gap:12px;
}

header img{
    height:48px;
    max-width:180px;
    object-fit:contain;
}

header .title{
    font-weight:600;
    font-size:16px;
}

#chat{
    flex:1;
    overflow-y:auto;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:12px;
}

.msg{
    max-width:85%;
    padding:12px 14px;
    border-radius:14px;
    line-height:1.5;
    white-space:pre-wrap;
    word-break:break-word;
}

.user{
    align-self:flex-end;
    background:var(--user);
    border-bottom-right-radius:4px;
}

.bot{
    align-self:flex-start;
    background:var(--bot);
    border:1px solid #ddd;
    border-bottom-left-radius:4px;
}

.media{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:6px;
}

.media img, .media iframe{
    max-width:160px;
    border-radius:8px;
}

.suggestions{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:8px;
}

.suggestions button{
    background:#eef2ff;
    border:1px solid #c7d2fe;
    border-radius:999px;
    padding:6px 12px;
    cursor:pointer;
    font-size:14px;
}

footer{
    background:#fff;
    border-top:1px solid #ddd;
    padding:10px;
}

.input-wrap{
    display:flex;
    gap:8px;
}

textarea{
    flex:1;
    resize:none;
    padding:10px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:15px;
}

button.send{
    background:var(--primary);
    color:#fff;
    border:none;
    padding:0 18px;
    border-radius:10px;
    font-size:15px;
    cursor:pointer;
}

@media(max-width:600px){
    header img{height:40px}
    .msg{max-width:95%}
}
</style>
</head>

<body>

<header>
    <img src="/static/logo.png" alt="Logo">
    <div class="title">Vietnam Travel AI</div>
</header>

<div id="chat"></div>

<footer>
    <div class="input-wrap">
        <textarea id="input" rows="1" placeholder="Hỏi về du lịch Việt Nam..."></textarea>
        <button class="send" onclick="send()">Gửi</button>
    </div>
</footer>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

function addMsg(text, cls){
    const d=document.createElement("div");
    d.className="msg "+cls;
    d.textContent=text;
    chat.appendChild(d);
    chat.scrollTop=chat.scrollHeight;
    return d;
}

function addMedia(parent, images, videos){
    if((images && images.length)||(videos && videos.length)){
        const m=document.createElement("div");
        m.className="media";
        images?.forEach(i=>{
            const img=document.createElement("img");
            img.src=i.url;
            img.alt=i.caption||"";
            m.appendChild(img);
        });
        videos?.forEach(v=>{
            const f=document.createElement("iframe");
            f.src=v.replace("watch?v=","embed/");
            f.width=160; f.height=90;
            f.allow="accelerometer; autoplay; encrypted-media";
            m.appendChild(f);
        });
        parent.appendChild(m);
    }
}

function addSuggestions(list){
    if(!list||!list.length)return;
    const s=document.createElement("div");
    s.className="suggestions";
    list.forEach(q=>{
        const b=document.createElement("button");
        b.textContent=q;
        b.onclick=()=>send(q);
        s.appendChild(b);
    });
    chat.appendChild(s);
}

async function send(text){
    const msg=text||input.value.trim();
    if(!msg)return;
    input.value="";
    addMsg(msg,"user");

    const r=await fetch("/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({msg})
    });
    const data=await r.json();

    const bot=addMsg(data.reply,"bot");
    addMedia(bot,data.images,data.videos);
    addSuggestions(data.suggestions);
}

input.addEventListener("keydown",e=>{
    if(e.key==="Enter"&&!e.shiftKey){
        e.preventDefault();
        send();
    }
});
</script>

</body>
</html>
