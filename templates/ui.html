<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vietnam Travel AI</title>

<style>
body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background:#f5f6f8;
    display:flex;
    flex-direction:column;
    height:100vh;
}

header{
    background:#fff;
    border-bottom:1px solid #ddd;
    padding:10px 16px;
    display:flex;
    align-items:center;
    gap:12px;
}

header img{
    height:56px;           /* LOGO TO HƠN */
    max-width:220px;
    object-fit:contain;
}

header .title{
    font-size:16px;
    font-weight:600;
}

#chat-box{
    flex:1;
    overflow-y:auto;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:12px;
}

.msg{
    max-width:85%;
    padding:12px 14px;
    border-radius:14px;
    white-space:pre-wrap;
    word-break:break-word;
    line-height:1.5;
}

.msg.user{
    align-self:flex-end;
    background:#d1f0e8;
    border-bottom-right-radius:4px;
}

.msg.bot{
    align-self:flex-start;
    background:#fff;
    border:1px solid #ddd;
    border-bottom-left-radius:4px;
}

.media{
    margin-top:6px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
}

.media img,
.media iframe{
    max-width:160px;
    border-radius:8px;
}

.suggestions{
    margin-top:8px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
}

.suggestions button{
    background:#eef2ff;
    border:1px solid #c7d2fe;
    padding:6px 12px;
    border-radius:999px;
    cursor:pointer;
    font-size:14px;
}

footer{
    background:#fff;
    border-top:1px solid #ddd;
    padding:10px;
}

.input-wrap{
    display:flex;
    gap:8px;
}

textarea{
    flex:1;
    resize:none;
    padding:10px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:15px;
}

button{
    background:#0a7cff;
    color:#fff;
    border:none;
    padding:0 16px;
    border-radius:10px;
    cursor:pointer;
}

@media(max-width:600px){
    .msg{max-width:95%}
    header img{height:44px}
}
</style>
</head>

<body>

<header>
    <img src="/static/logo.png" alt="Logo">
    <div class="title">Vietnam Travel AI</div>
</header>

<div id="chat-box"></div>

<footer>
    <div class="input-wrap">
        <textarea id="msg" rows="1" placeholder="Hỏi về du lịch Việt Nam..."></textarea>
        <button onclick="send()">Gửi</button>
    </div>
</footer>

<script>
const chatBox = document.getElementById("chat-box");
const msgInput = document.getElementById("msg");

function addMessage(text, role){
    const div = document.createElement("div");
    div.className = "msg " + role;
    div.textContent = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
    return div;
}

function addMedia(parent, images, videos){
    if((images && images.length) || (videos && videos.length)){
        const m = document.createElement("div");
        m.className = "media";

        images?.forEach(i=>{
            const img=document.createElement("img");
            img.src=i.url;
            m.appendChild(img);
        });

        videos?.forEach(v=>{
            const iframe=document.createElement("iframe");
            iframe.src=v.replace("watch?v=","embed/");
            iframe.width=160;
            iframe.height=90;
            iframe.allow="accelerometer; autoplay; encrypted-media";
            m.appendChild(iframe);
        });

        parent.appendChild(m);
    }
}

function addSuggestions(list){
    if(!list || !list.length) return;
    const s=document.createElement("div");
    s.className="suggestions";
    list.forEach(q=>{
        const b=document.createElement("button");
        b.textContent=q;
        b.onclick=()=>send(q);
        s.appendChild(b);
    });
    chatBox.appendChild(s);
}

async function send(text){
    const content = text || msgInput.value.trim();
    if(!content) return;

    msgInput.value="";
    addMessage(content,"user");

    const r = await fetch("/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({msg:content})
    });
    const data = await r.json();

    const bot = addMessage(data.reply,"bot");
    addMedia(bot, data.images, data.videos);
    addSuggestions(data.suggestions);
}

msgInput.addEventListener("keydown",e=>{
    if(e.key==="Enter" && !e.shiftKey){
        e.preventDefault();
        send();
    }
});
</script>

</body>
</html>
